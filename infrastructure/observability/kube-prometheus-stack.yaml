---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: grafana
  namespace: observability
spec:
  encryptedData:
    admin-user: AgDybloxKuEracMTqcZAM8FtNOx7PlZewiOQFqWU1yBFyGJ5v6fBy5pnWyMu86n2ev4K6x24IApOTtH2Tk88kG+iqdqWzXbKGdLYgxXzz2osdFguW1S89sXJMWUGAiahkig7dNT0j2NcaTkRgEJbLky51L+ruWxjnh7dixk37RAFdbN4yLdrhw2DTc6V6pzL3i4DsigddPV25bIf30wzh37Ygm7VmhYSEoynn9gOVyqk10pIALQoN60PQwY9I72tAmsOX5Sc0OBawketnYFoyEY5Wfbh16Oj3xVqJK1CV8KNRE495X5F7uDdd4Wa+jcf4wm7ZvaRvJ0nGrTLhvhT9r+NYOMLwbbVsRN9aQNkeUjpj3/uyChFXMS6ckrFKWVysf+nxODEbuiYBj+Y2kOUP/eVM1o5fUHZ88SjrSbG99BOdcBc+3wnuGjl7ARGISNfn3u2foQnXVBBqAg5u3C/9j9iLTX+WQO7tv2E0jPisFO5lH70WF7hobOb/PC/G1uLsELL4S8Qd7Dg2xNAKQ8Sc9deN/REhSAu7Nbe30/26sfgOST2uRgm4ccdPnfpN6HBW/rBJSaa2bCIsGg++F7lBVhU6GIO28ART1NyVaJXaAcQy/v5TjL1P5WVTg1XudHKqn4OW5VDm29W5DJo5OQoa32HRmbT323+bnMGLYXTMkLDSTH++2i2wejj7vhb8/IbOC1z+oZmRA==
    admin-password: AgAY7OyJvmYBjMvr5oIg9YHvNplRyYA/qCtQLcVXHFGF+WoxDUEuFnaIZXS5ZbGvRtsqAMNmGvAmLJzMb/9n9BsdCgaIZGy+joioXIMaRQ/uQFC7iDEn0c8M3HlMktO+ZKzdZ8dB+kcl2DOc/nyQwDD2MFb3E1q/xXYuxHsv9DpdAMEHwpTWuTO/nqTfBOuvPGC/e/90EFIL4yLxTtWQ1CeJ28ASCXmwbXh5R3SzgMSxkS4f8bpObgXMm9ZCWUWiJXhMF7RVDhPtaYgV5iQS1vS0QXVl9W21hmkt0t/+7FuG5BW4m2uWVyvvXOMfOod4NhzMF2in+jm7m71zRX6+TRF9A6PTnPUm+oPG/ZEirngAvjVbW4IVA33p0Q5+IqMD2xIRnWk4a0ysRXjGqcZufnm989O4TuSX0rP1V/meDMYlS3LOVA8uH65xN9ZzsRfy83sRxnxGuSVa7kN3Dx7t3nfd30ZB1w4GmNiLLk1nNtVv5egLl4SWmgnf2GOZz28uYBmYzQXcxfk/m9ZNQk/po2mVt0SZLGKZKdLuQWSNPdu/PQO/UtPo1GcQwfPruMsz0J40nTwB5bEkFHYbTVtu6g2cZNjTxmR6Eo4JwsWRYpHxsGqWTqsrFCXprk+XML6E5b2GGXkfCDzL0u8Io/q+N0JEwRiiIW4RISZPS6T6Uj8UviFnIVTZqTZUALZ9MNoeYFU2dv0egyUahM7bjX2hH3JiNx7fxmMXDmwTpsY4Bq5JgNUnH4NJ7VYTxtuWXMJuhzP9BQ==
  template:
    metadata:
      creationTimestamp: null
      name: grafana
      namespace: observability

---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: prometheus-community-charts
  namespace: observability
spec:
  interval: 24h
  url: https://prometheus-community.github.io/helm-charts

---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: kube-prometheus-stack
  namespace: observability
spec:
  interval: 30m
  chart:
    spec:
      chart: kube-prometheus-stack
      version: "61.x"
      sourceRef:
        kind: HelmRepository
        name: prometheus-community-charts
        namespace: observability
      interval: 12h
  # https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/values.yaml
  values:
    grafana:
      admin:
        existingSecret: grafana
        userKey: admin-user
        passwordKey: admin-password
      ingress:
        enabled: true
        ingressClassName: nginx
        path: /grafana
        hosts:
          - cursedcompass.ddns.net
      # https://github.com/prometheus-community/helm-charts/issues/2837
      grafana.ini:
        security:
          cookie_secure: false
        server:
          domain: cursedcompass.ddns.net
          protocol: http
          root_url: "%(protocol)s://%(domain)s:%(http_port)s/grafana/"
          serve_from_sub_path: true
